"use strict";var bcrypt=require("bcrypt"),User=require("../Models/User"),jwt=require("jsonwebtoken");require("dotenv").config(),exports.signup=function(r,s){var t,a,n,u,c,o,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=r.body,a=t.name,n=t.email,u=t.password,c=t.role,e.next=4,regeneratorRuntime.awrap(User.findOne({email:n}));case 4:if(e.sent)return e.abrupt("return",s.status(400).json({success:!1,message:"User Already Exists"}));e.next=7;break;case 7:return e.prev=7,e.next=10,regeneratorRuntime.awrap(bcrypt.hash(u,10));case 10:o=e.sent,e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(7),e.abrupt("return",s.status(500).json({success:!1,message:"Error in hashing password"}));case 16:return e.next=18,regeneratorRuntime.awrap(User.create({name:a,email:n,password:o,role:c}));case 18:return i=e.sent,e.abrupt("return",s.status(200).json({success:!0,message:"User Created Successfully",data:i}));case 22:return e.prev=22,e.t1=e.catch(0),console.error(e.t1),e.abrupt("return",s.status(500).json({success:!1,message:"User cannot be register,Please try again later"}));case 26:case"end":return e.stop()}},null,null,[[0,22],[7,13]])},exports.login=function(r,s){var t,a,n,u,c,o,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=r.body,a=t.email,n=t.password,a&&n){e.next=4;break}return e.abrupt("return",s.status(400).json({success:!1,message:"Please fill all the details carefully"}));case 4:return e.next=6,regeneratorRuntime.awrap(User.findOne({email:a}));case 6:if(u=e.sent){e.next=9;break}return e.abrupt("return",s.status(401).json({success:!1,message:"User does not exist"}));case 9:return c={email:u.email,id:u._id,role:u.role},e.next=12,regeneratorRuntime.awrap(bcrypt.compare(n,u.password));case 12:if(!e.sent){e.next=21;break}o=jwt.sign(c,process.env.JWT_SECRET,{expiresIn:"2h"}),(u=u.toObject()).token=o,u.password=void 0,i={expires:new Date(Date.now()+2592e5),httpOnly:!0},s.cookie("token",o,i).status(200).json({success:!0,token:o,user:u,message:"User logged in successfully"}),e.next=22;break;case 21:return e.abrupt("return",s.status(403).json({success:!1,message:"Password does not match"}));case 22:e.next=28;break;case 24:return e.prev=24,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",s.status(500).json({success:!1,message:"Login false"}));case 28:case"end":return e.stop()}},null,null,[[0,24]])};
//# sourceMappingURL=Auth.min.js.map
